// filepath: c:\Users\Usuario\xampp\htdocs\Sprint\Sprint5\5.1_API_Fields_Booking\Dockerfile
# Usa un'immagine ufficiale di PHP con Composer
FROM composer:2 as vendor

WORKDIR /app
COPY database/ database/
COPY composer.json composer.lock ./
# Installa le dipendenze di produzione
RUN composer install --no-dev --no-interaction --optimize-autoloader

# Usa un'immagine PHP-FPM per l'esecuzione
FROM php:8.2-fpm

# Installa le dipendenze di sistema e le estensioni PHP
RUN apt-get update && apt-get install -y \
    libzip-dev \
    unzip \
    git \
    procps \
    netcat-openbsd \
    && docker-php-ext-install zip pdo_mysql

# Copia i file dell'applicazione e le dipendenze installate
WORKDIR /app
COPY --from=vendor /app/vendor/ /app/vendor/
COPY . .

# Imposta i permessi corretti
RUN chown -R www-data:www-data /app/storage /app/bootstrap/cache

# Esponi la porta 9000 per PHP-FPM
EXPOSE 9000

# Imposta il nuovo entrypoint
ENTRYPOINT ["entrypoint.sh"]

# Comando di avvio
CMD ["php-fpm"]